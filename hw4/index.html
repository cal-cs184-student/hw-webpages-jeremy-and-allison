<html>
<head>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=default'></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
	h1 {
		text-align: center;
	}

	.container {
		margin: 0 auto;
		padding: 60px 20%;
	}

	figure {
		text-align: center;
	}

	img {
		display: inline-block;
	}

	body {
		font-family: 'Inter', sans-serif;
	}
</style>
</head>
<body>
<div class="container">
<h1>CS184/284A Spring 2025 Homework 4 Write-Up</h1>
<div style="text-align: center;">Names: </div>

<br>

Link to webpage:<a href="https://cal-cs184-student.github.io/hw-webpages-jeremy-and-allison/hw4/index.html">https://cal-cs184-student.github.io/hw-webpages-jeremy-and-allison/hw4/index.html</a>

<br>

Link to GitHub repository:<a href="https://github.com/cal-cs184-student/hw-webpages-jeremy-and-allison">https://github.com/cal-cs184-student/hw-webpages-jeremy-and-allison</a>

<figure>
	<img src="Part 5 Mirror.png" alt="Cloth draped over sphere" style="width:70%"/>
</figure>

<!--
We've already added one heading per part, to make your write-up as navigable when grading. Please fit your write-up within these sections!
-->

<h2>Overview</h2>
In this assignment, we explore introductory physics simulation strategies to create a convincing cloth simulation. First, we implement point masses, connect them with springs, and move them with Verlet integration. Next, we handle a collision with external objects and the cloth itself. To ensure the simulation can be run in real time we implement a spatial map to avoid the naive solution of checking every other point mass. Finally, we learn how to implement shaders to create engaging lighting, bump, and displacement effects on our objects.

<h2>Part 1: Masses and springs</h2>
The first task is creating a cloth mesh by creating point masses in a grid structure and connecting them with spring constraints. The constraints are defined as:
-Structure: Connection to left point mass and one above it.
-Shearing: Connection to diagonal upper left and diagonal upper right.
-Bending: Connection to two away to its left and two away above.

<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 1 All.png" width="400px"/>
			<figcaption>All springs</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 1 Only Shear.png" width="400px"/>
			<figcaption>Only Shear</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 1 No Shear.png" width="400px"/>
			<figcaption>No Shear</figcaption>
		</td>
		</tr>
	</table>
</div>

<h2>Part 2: Simulation via numerical integration</h2>
With the grid complete, external forces were applied to the point masses like gravity and spring correction forces. The movement of the point masses was complete with verlet integration and to prevent deformation, the 10% rule was implemented from the SIGGRAPH paper. As a result the cloth can be seen flowing wit default parameters

<b>TA's the following are gifs, please look on the website. Gifs are better at showcasing the behavior than images.
	https://cal-cs184-student.github.io/hw-webpages-jeremy-and-allison/hw4/index.html
</b>

<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 2 Default.gif" width="400px"/>
			<figcaption>Default Parameters</figcaption>
		</td>
		<tr>
	</table>
</div>

The effect of changing the spring constant <code>ks</code> can be seen below. The value controls the stiffness of the cloth, with higher values resulting in fewer wrinkles.
<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 2 ks 500.gif" width="400px"/>
			<figcaption>ks 500</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 2 ks 10k.gif" width="400px"/>
			<figcaption>ks 10k</figcaption>
		</td>
		</tr>
	</table>
</div>

The effect of changing the density can be seen below. A higher density leads to a similar effect of low ks, the cloth is dragged down by the weight creating wrinkles. With less density, the lower half of the cloth tugs on the upper half less leading to fewer wrinkles.
<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 2 density 5.gif" width="400px"/>
			<figcaption>Density 5</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 2 density 1000.gif" width="400px"/>
			<figcaption>Density 1000</figcaption>
		</td>
		</tr>
	</table>
</div>

The effect of changing the damping can be seen below. The extreme of 100% damp shows the cloth very slowly falling. The extreme of 0% damp shows the cloth flowing back and forth both ways as it fails to come to a resting stop.
<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 2 Full Damp.gif" width="400px"/>
			<figcaption>Damp 100%</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 2 No Damp.gif" width="400px"/>
			<figcaption>Damp 0%</figcaption>
		</td>
		</tr>
	</table>
</div>

The final resting position of pinned4.json can be seen below, both the wire frame and shaded.
<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 2 Pinned4 Shaded.png" width="400px"/>
			<figcaption>Density 5</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 2 Pinned4 Wire.png" width="400px"/>
			<figcaption>Density 1000</figcaption>
		</td>
		</tr>
	</table>
</div>

<h2>Part 3: Handling collisions with other objects</h2>
Collision math was implemented to handle collisions with spheres and planes. For spheres, we check if the point mass distance from the sphere center is less than the radius, if so, calculate a correction vector. To calculate the correction vector, we find the trajectory of the point mass and where it would intersect with the sphere.

<code>intersection = origin + (radius/pm.(position - origin).norm()) * (pm.position - origin);</code>

The correction is simply the difference between the intersection and the last position. The actual correction applied is scaled down by a friction parameter.  

The result of the sphere collisions can be seen below. With very low <code>ks</code> the cloth is less stiff and drapes and with very high <code>ks</code> the cloth clings the the sphere and is stiffer.

<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 3 ks 500.png" width="400px"/>
			<figcaption>ks 500</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 3 ks 5k.png" width="400px"/>
			<figcaption>ks 5k</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 3 ks 50k.png" width="400px"/>
			<figcaption>ks 50k</figcaption>
		</td>
		</tr>
	</table>
</div>

For planes, the steps are the same as the sphere but the intersection math is different. We check if the trajectory goes through the plane by checking if the dot product flips signs (as 0 is particular/on the plane). If so we apply a correction vector. As a result, the cloth can be seen lying on the plane.

<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 3 Rest.png" width="400px"/>
			<figcaption></figcaption>
		</td>
		</tr>
	</table>
</div>

<h2>Part 4: Handling self-collisions</h2>
To handle self-collision, we could naively check each point mass against every other point mass. However, if we could somehow only check the point masses that are nearby, it could save an order of magnitude of computation. To do this, a spatial map is constructed; a hash map that holds a vector of pointers to point masses within some volume cube. Every time step, each point mass's position is hashed and snapped into the closest volume box. This way, we don't have to brute-force create volume boxes across the entire scene, we only store volume boxes that actually have point masses. Then, when it's time to check for collisions, you only need to check against the point masses that are in the same volume box as you. Each point mass that was less than <code>2 * thickness</code> away from the current point mass had its correction vector accumulated, and the average of those was used as the final correction vector applied to the point mass.

<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 4 Begin.png" width="400px"/>
			<figcaption>Begin</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 4 Middle.png" width="400px"/>
			<figcaption>Middle</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 4 End.png" width="400px"/>
			<figcaption>End</figcaption>
		</td>
		</tr>
	</table>
</div>

<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 4 ks 50k.png" width="400px"/>
			<figcaption>ks 50k</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 4 Density 100.png" width="400px"/>
			<figcaption>Density 100</figcaption>
		</td>
		</tr>
	</table>
</div>

<h2>Part 5: Shaders</h2>
<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 5 Phong.png" width="400px"/>
			<figcaption>Phong</figcaption>
		</td>
		</tr>
	</table>
</div>
<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 5 Diffuse.png" width="400px"/>
			<figcaption>Diffuse</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 5 Spec.png" width="400px"/>
			<figcaption>Specular</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 5 Amb.png" width="400px"/>
			<figcaption>Ambience</figcaption>
		</td>
		</tr>
	</table>
</div>

<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 5 Texture 1.png" width="400px"/>
			<figcaption></figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 5 Texture 2.png" width="400px"/>
			<figcaption></figcaption>
		</td>
		</tr>
	</table>
</div>

<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 5 Bump normal 2 height dot3 -o16 -a16.png" width="400px"/>
			<figcaption>Bump normal:2 height:0.3 -o16 -a16</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 5 Bump normal 2 height dot3 -o128 -a128.png" width="400px"/>
			<figcaption>Bump normal:2 height:0.3 -o128 -a128</figcaption>
		</td>
		</tr>
	</table>
</div>

<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Displacement 2 height dot3 -o16 -a16.png" width="400px"/>
			<figcaption>Displacement normal:2 height:0.3 -o16 -a16</figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 5 Displacement normal 2 height dot3 -o128 -a128.png" width="400px"/>
			<figcaption>Displacement normal:2 height:0.3 -o128 -a128</figcaption>
		</td>
		</tr>
	</table>
</div>

<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 5 Mirror.png" width="400px"/>
			<figcaption>Displacement normal:2 height:0.3 -o16 -a16</figcaption>
		</td>
		</tr>
	</table>
</div>

<div style="display: flex; flex-direction: column; align-items: center;">
	<table style="width: 100%; text-align: center; border-collapse: collapse;">
		<tr>
		<td style="text-align: center;">
			<img src="Part 5 Extra 1.png" width="400px"/>
			<figcaption></figcaption>
		</td>
		<td style="text-align: center;">
			<img src="Part 5 Extra 2.png" width="400px"/>
			<figcaption></figcaption>
		</td>
		</tr>
	</table>
</div>

<h2>Additional Notes</h2>

</div>
</body>
</html>